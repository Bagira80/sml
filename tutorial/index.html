<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Krzysztof Jusiak">
  
  <title>Tutorial - boost.msm-lite</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/codemirror.css">
  <link rel="stylesheet" href="../css/highlight.css">
  <link rel="stylesheet" href="../css/mdn-like.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Tutorial";
    var mkdocs_page_input_path = "tutorial.md";
    var mkdocs_page_url = "/tutorial/index.html";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script>

  <script src="../js/codemirror/codemirror.js"></script>
  <script src="../js/codemirror/clike.js"></script>
  <script src="../js/codemirror/active-line.js"></script>

  <script src="../js/cpp.js"></script>
  <script src="../js/gitter.js"></script>
  <script src="../js/html.js"></script>
  <script src="../js/youtube.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

	
	<nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">

      <a href="http://boost.org"><img src="../img/boost.png" /></a>
      <a href="../index.html" class="icon icon-home" style="font-weight:bold;text-align:left;padding:0.809em;color:#fcfcfc;margin-bottom:0.809em"> boost.msm-lite</a>

      <div class="wy-side-nav-search">
		<div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">

        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../index.html">Introduction</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../overview/index.html">Overview</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="index.html">Tutorial</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#0-read-boostmsm-euml-documentation">0. Read Boost.MSM - eUML documentation</a></li>
                
            
                <li class="toctree-l3"><a href="#1-create-events-and-states">1. Create events and states</a></li>
                
            
                <li class="toctree-l3"><a href="#2-create-guards-and-actions">2. Create guards and actions</a></li>
                
            
                <li class="toctree-l3"><a href="#3-create-a-transition-table">3. Create a transition table</a></li>
                
            
                <li class="toctree-l3"><a href="#4-set-initial-states">4. Set initial states</a></li>
                
            
                <li class="toctree-l3"><a href="#5-create-a-state-machine">5. Create a state machine</a></li>
                
            
                <li class="toctree-l3"><a href="#6-process-events">6. Process events</a></li>
                
            
                <li class="toctree-l3"><a href="#8-testing-a-state-machine">8. Testing a state machine</a></li>
                
            
                <li class="toctree-l3"><a href="#9-debugging-a-state-machine">9. Debugging a state machine</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../user_guide/index.html">User Guide</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../examples/index.html">Examples</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../CHANGELOG/index.html">CHANGELOG</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../TODO/index.html">TODO</a>
        
    </li>
<li>
          
        </ul>
      </div>

    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">boost.msm-lite</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      
    
    <li>Tutorial</li>
    <li class="wy-breadcrumbs-aside">
      
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>All code examples include <code>boost/msm-lite.hpp</code> as well as declare a convienent msm namespace alias.</p>
<pre><code class="cpp">#include &lt;boost/msm-lite.hpp&gt;
namespace msm = boost::msm::lite;
</code></pre>

<h3 id="0-read-boostmsm-euml-documentation">0. Read Boost.MSM - eUML documentation</h3>
<ul>
<li><a href="http://www.boost.org/doc/libs/1_60_0/libs/msm/doc/HTML/ch02.html">Boost.MSM - UML Short Guide</a></li>
<li><a href="http://www.boost.org/doc/libs/1_60_0/libs/msm/doc/HTML/ch03s04.html">Boost.MSM - eUML Documentation</a></li>
</ul>
<h3 id="1-create-events-and-states">1. Create events and states</h3>
<p>State machine is composed of finite number of states and transitions which are triggered via events.</p>
<p>An Event is just a unique type, which will be process by the state machine.</p>
<pre><code class="cpp">struct my_event { ... };
</code></pre>

<p>A State can have entry/exit behaviour which is executed whenever state is entered or left and
represents current location of the state machine processing.</p>
<p>To create a state below snipped might be used.</p>
<pre><code class="cpp">msm::state&lt;class idle&gt; idle;
// or
auto idle = msm::state&lt;class idle&gt;{};
</code></pre>

<p>If you happen to have a clang/gcc compiler, you can create a state on the fly by.</p>
<pre><code class="cpp">using namespace msm;
auto state  = &quot;idle&quot;_s;
</code></pre>

<p><code>msm-lite</code> states cannot have data as data is injected directly into guards/actions instead.</p>
<p>A state machine might be a state itself.</p>
<pre><code class="cpp">msm::state&lt;msm::sm&lt;state_machine&gt;&gt; composite;
</code></pre>

<p><code>msm-lite</code> supports <code>terminate</code> state, which stops process events to be processed.</p>
<p>States are printable too.</p>
<pre><code class="cpp">assert(string(&quot;idle&quot;) == &quot;idle&quot;_s.c_str());
</code></pre>

<h3 id="2-create-guards-and-actions">2. Create guards and actions</h3>
<p>Guards and actions are callable objects which will be executed by the state machine in order to verify whether a transition, followed by an action should take place.</p>
<p>Guard is required to return boolean value.</p>
<pre><code class="cpp">auto guard1 = [] {
    return true;
};

auto guard2 = [](int, double) { // guard with dependencies
    return true;
};

auto guard3 = [](int, auto event, double) { // guard with an event and dependencies
    return true;
};

struct guard4 {
    bool operator()() const noexcept {
        return true;
    }
};
</code></pre>

<p>Action is required not to return.</p>
<pre><code class="cpp">auto action1 = [] { };
auto action2 = [](int, double) { }; // action with dependencies
auto action3 = [](int, auto event, double) { }; // action with an event and dependencies
struct action4 {
    void operator()() noexcept { }
};
</code></pre>

<h3 id="3-create-a-transition-table">3. Create a transition table</h3>
<p>When we have states and events handy we can finally create a transition table which represents
our transitions.</p>
<p><code>msm-lite</code> is using eUML-like DSL in order to be as close as possible to UML design.</p>
<ul>
<li>
<p>Transition Table DSL</p>
<table>
<thead>
<tr>
<th>Expression</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>state + event<e> [ guard ]</td>
<td>internal transition on event e when guard</td>
</tr>
<tr>
<td>src_state == dst_state / [] {}</td>
<td>anonymous transition with action</td>
</tr>
<tr>
<td>src_state == dst_state + event<e></td>
<td>transition on event e without guard or action</td>
</tr>
<tr>
<td>src_state == dst_state + event<e> [ guard ] / action</td>
<td>transition from src_state to dst_state on event e with guard and action</td>
</tr>
<tr>
<td>src_state == dst_state + event<e> [ guard &amp;&amp; (![]{return true;} &amp;&amp; guard2) ] / (action, action2, []{})</td>
<td>transition from src_state to dst_state on event e with guard and action</td>
</tr>
</tbody>
</table>
</li>
</ul>
<p>To create a transition table <a href="../user_guide/index.html#make_transition_table-state-machine"><code>make_transition_table</code></a> is provided.</p>
<pre><code class="cpp">using namespace msm;
make_transition_table(
    &quot;src_state&quot;_s == &quot;dst_state&quot;_s + event&lt;my_event&gt; [ guard ] / action
);
</code></pre>

<h3 id="4-set-initial-states">4. Set initial states</h3>
<p>Initial states tells the state machine where to start.</p>
<pre><code class="cpp">using namespace msm;
make_transition_table(
    &quot;src_state&quot;_s(initial) == &quot;dst_state&quot;_s + event&lt;my_event&gt; [ guard ] / action,
    &quot;dst_state&quot;_s          == terminate     + event&lt;game_over&gt;
);
</code></pre>

<p>You can have more than one initial state. Both initial states will be executed in pseudo parallel way
and are called orthogonal regions.</p>
<pre><code class="cpp">using namespace msm;
make_transition_table(
    &quot;region_1&quot;_s(initial) == &quot;dst_state1&quot;_s + event&lt;my_event1&gt; [ guard ] / action,
    &quot;dst_state1&quot;_s          == terminate    + event&lt;game_over&gt;

    &quot;region_2&quot;_s(initial) == &quot;dst_state2&quot;_s + event&lt;my_event2&gt; [ guard ] / action,
    &quot;dst_state2&quot;_s          == terminate    + event&lt;game_over&gt;
);
</code></pre>

<h3 id="5-create-a-state-machine">5. Create a state machine</h3>
<p>State machine is an abstraction for transition table holding current states and processing events.
To create a state machine, firstly we have to configure our transition table.</p>
<pre><code class="cpp">class example {
public:
    auto configure() noexcept {
        using namespace msm;
        return make_transition_table(
            &quot;src_state&quot;_s(initial) == &quot;dst_state&quot;_s + event&lt;my_event&gt; [ guard ] / action,
            &quot;dst_state&quot;_s          == terminate     + event&lt;game_over&gt;
        );
    }
};
</code></pre>

<p>Having transition table configured we can create a state machine.</p>
<pre><code class="cpp">msm::sm&lt;example&gt; sm;
</code></pre>

<p>State machine constructor is responsible to provide required dependencies for actions and guards.</p>
<pre><code class="cpp">                             /---- event
                            |
auto guard = [](double d, auto event) { return true; }
                   |
                   \-------\
                           |
auto action = [](int i){}  |
                 |         |
                 |         |
            /---/  /------/
           |      /
msm::sm&lt;exmple&gt; s{42, 87.0};

msm::sm&lt;exmple&gt; s{87.0, 42}; // order in which parameters have to passed is not specificied
</code></pre>

<p>Passing and maintaining a lot of dependencies might be tedious and require huge amount of boilerplate code.
In order to avoid it, Dependency Injection Library might be used to automate this process.
For example, we can use <a href="https://github.com/boost-experimental/di">experimental Boost.DI</a>.</p>
<pre><code class="cpp">auto injector = di::make_injector(
    di::bind&lt;&gt;.to(42)
  , di::bind&lt;interface&gt;.to&lt;implementation&gt;()
);

auto sm = injector.create&lt;sm&lt;example&gt;&gt;();
assert(sm.process_event(e1{}));
</code></pre>

<h3 id="6-process-events">6. Process events</h3>
<p>State machine is a simple creature. The main feature of it is to process events.
In order to do so, <code>process_event</code> method might be used.</p>
<pre><code class="cpp">msm::sm&lt;example&gt; sm;

assert(sm.process_event(my_event{})); // returns true when handled
assert(!sm.process_event(int{})); // not handled by the state machine
</code></pre>

<p><code>msm-lite</code> also provides a way to dispatch dynamically created events into the state machine.</p>
<pre><code class="cpp">struct runtime_event {
  int id = 0;
};
struct event1 {
  static constexpr auto id = 1;
};

auto dispatch_event = msm::make_dispatch_table&lt;runtime_event, 1 /*min*/, 5 /*max*/&gt;(sm);
  {
    runtime_event event{1};
    assert(dispatch_event(event, event.id)); // will call sm.process(event1{});
  }
</code></pre>

<h3 id="8-testing-a-state-machine">8. Testing a state machine</h3>
<p>Sometimes it is useful to verify whether a state machine is in a specific states, for example, whether
we are in a terminate state or not. We can do it with <code>msm-lite</code> using <code>is</code> or <code>visit_current_states</code>
functionality.</p>
<pre><code class="cpp">msm::sm&lt;example&gt; sm;
assert(sm.process_event(my_event{}));
assert(sm.is(terminate)); // is(terminate, s1, ...) when you have orthogonal regions

//or

sm.visit_current_states([](auto state) { std::cout &lt;&lt; state.c_str() &lt;&lt; std::endl; });
</code></pre>

<p>On top of that, <code>msm-lite</code> provides testing facilities to check state machine as a whole.
<code>set_current_states</code> method is available from <code>testing::sm</code> in order to set state machine
in a requested state.</p>
<pre><code class="cpp">testing::sm&lt;example&gt; sm{fake_data...};
sm.set_current_states(&quot;s3&quot;_s); // set_current_states(&quot;s3&quot;_s, &quot;s1&quot;_s, ...) for orthogonal regions
assert(sm.process_event(event{}));
assert(sm.is(terminate));
</code></pre>

<h3 id="9-debugging-a-state-machine">9. Debugging a state machine</h3>
<p><code>msm-lite</code> provides logging capabilities in order to print state machine flow.
To enable logging you have to define <code>BOOST_MSM_LOG</code>.</p>
<pre><code class="cpp">template &lt;class SM, class TEvent&gt;
void log_process_event(const TEvent&amp;) {
  printf(&quot;[%s][process_event] %s\n&quot;, typeid(SM).name(), typeid(TEvent).name());
}

template &lt;class SM, class TAction, class TEvent&gt;
void log_guard(const TAction&amp;, const TEvent&amp;, bool result) {
  printf(&quot;[%s][guard] %s %s %s\n&quot;, typeid(SM).name(), typeid(TAction).name(), typeid(TEvent).name(),
         (result ? &quot;[OK]&quot; : &quot;[Reject]&quot;));
}

template &lt;class SM, class TAction, class TEvent&gt;
void log_action(const TAction&amp;, const TEvent&amp;) {
  printf(&quot;[%s][action] %s %s\n&quot;, typeid(SM).name(), typeid(TAction).name(), typeid(TEvent).name());
}

template &lt;class SM, class TSrcState, class TDstState&gt;
void log_state_change(const TSrcState&amp; src, const TDstState&amp; dst) {
  printf(&quot;[%s][transition] %s -&gt; %s\n&quot;, typeid(SM).name(), src.c_str(), dst.c_str());
}

#define BOOST_MSM_LOG(T, SM, ...) log_##T&lt;SM&gt;(__VA_ARGS__)
#include &lt;boost/msm.hpp&gt;
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../user_guide/index.html" class="btn btn-neutral float-right" title="User Guide">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../overview/index.html" class="btn btn-neutral" title="Overview"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div id="disqus_thread"></div>
  <script type="text/javascript">
  /* * * CONFIGURATION VARIABLES * * */
  var disqus_shortname = 'msm-lite';

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2016</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../overview/index.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../user_guide/index.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
