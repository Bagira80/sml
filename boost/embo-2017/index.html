<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>'Embedding' a Meta State Machine</title>

		<meta name="description" content="'Embedding' a Meta State Machine">
		<meta name="author" content="Kris Jusiak">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/league.css" id="theme">

		<!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">
			<div class="slides">

          <section data-markdown=""
                   data-separator="^====+$"
                   data-separator-vertical="^----+$"
                   data-notes="^Note:">
					<script type="text/template">

emBO++ 2017

#'Embedding' a Meta State Machine

Kris Jusiak

---

[kris@jusiak.net](mailto:kris@jusiak.net) | [@krisjusiak](https://twitter.com/krisjusiak) | [linkedin.com/in/kris-jusiak](https://www.linkedin.com/in/kris-jusiak)

==============================================================================

##Agenda

* Demo
* Summary

==============================================================================

##UML State Machine

----

**UML State Machine** (SM) depict the dynamic behavior of an entity based on its response to events, 
showing how the entity reacts to various events depending on the current state that it is in

> Formerly called **UML state chart** in UML 1

----

####State Machine Concepts

![State Machine](images/sm.png)

----

| UML Concept         | Description |
| ------------------- | ----------- |
| Event               | Trigger which affects the system, ex. `button click`           |
| State               | Captures aspect of relavant system history, ex. `Playing`            |
| Transition          | Conditionally update current state, ex. `when button click update current state to Playing` |

----

##Do I need a State Machine?

----

###No, But...

----

* SM promotes better design
  * Compliant with UML documentation

* SM creates easier to maintain code
  * Declarative approach / Expresses `WHAT`, not `HOW`!

* SM creates easy to test code
  * Can be tested in isolation without trying to reach all conditional branches

----

##Featuers

| Minimal | Basic | Others |
| ------- | ----- | ------ |
| Transitions | Composite, Orthogonal Regions | Logging |


----

![Transition](images/transition.png)

----

![Food](images/food.png)

----

![Food1](images/food_1.png)

![Food2](images/food_2.png)

![Food3](images/food_3.png)

----

```cpp
Working : hungry [is_lunch_time] / get_some_food -> Eating
```

```cpp
Eating : finished / chill -> Resting
```

```cpp
Resting : break_is_over -> Working
```

----

##[Boost].SML

```cpp
class hungry {};
class finished {};
class break_is_over {};
```

```cpp
const auto is_lunch_time = []{ return true; };
const auto get_some_food = []{};
const auto chill = []{};
```

```cpp
make_transition_table(
 * "Working"_s + event<hungry> [is_lunch_time] / get_some_food = "Eating"_s,
   "Eating"_s  + event<finished> / chill = "Resting"_s,
   "Resting"_s + event<break_is_over> = "Working"_s
);
```

----


##[Boost].SML

> UML-2.5 State Machine Language

https://github.com/boost-experimental/sml

-----

##Boost.SML

* One header - 2k LOC - (boost/sml.hpp) / generated
* Neither Boost nor STL is required
* Supports UML-2.5
* Quick compilation-times
* Fast run-time
* Supported compilers (C++14)
  * [Clang-3.4+](https://travis-ci.org/boost-experimental/sml), [XCode-6.1+](https://travis-ci.org/boost-experimental/sml), [GCC-5.2+](https://travis-ci.org/boost-experimental/di), [MSVC-2015+](https://ci.appveyor.com/project/krzysztof-jusiak/sml)

----

##Boost.SML - Hello World

![hello world](images/sml.png)

----

##Boost.SML - Hello World

```cpp
#include <boost/sml.hpp>
namespace sml = boost::sml;
```

```cpp
// events
struct eat {};
struct full {};
```

```cpp
// guards/actions
const auto is_lunch_time = [] { return true; };
const auto go_for_food = [] { puts("going for food..."); };
```

```cpp
struct hello_world {
 auto operator()() const {
  // Transition table: src_state + event [ guard ] / action = dst_state
  return make_transition_table(
   *"hungry"_s + event<eat> [is_lunch_time] / go_for_food = "eating"_s
  , "eating"_s + event<full> / [] { puts("done!"); } = X
  );
 }
};
```

----

##Boost.SML - Hello World

```cpp
int main() {
  sml::sm<hello_world> sm;
  static_assert(1 == sizeof(sm), "sizeof(sm) != 1b");

  sm.process_event(eat{});
  sm.process_event(full{});
}
```

```sh
$./a.out
  going for food...
  done!
```

----

##Boost.SML - Hello World

```sh
time $CXX -std=c++14 hello_world.cpp # 0.079s
```

####ASM x86-64

```
process_event<eat>:
    movb  $1, (%r8)     // current state = 1
    movl  $.L.str, %edi // puts("going for food...")
    callq puts
    movl  $1, %eax      // handled
    ret

main:
    leaq  16(%rsp), %rdi
    movq  %rbx, %rsi
    movq  %rbx, %rdx
    movq  %rbx, %rcx
    movq  %rbx, %r8
    call  *process_event<eat> // O(1) - jump table
    ...
```

----

##Benchmarks (Clang-3.8)

| [Complex Test](https://github.com/boost-experimental/sml/tree/master/test/pt/complex) |      Boost.SML | Boost.MSM-eUML   | Boost.Statechart   |
|------------------|----------------|------------------|--------------------|
| Compilation time | 0.582s         | 1m15.935s        | 3.661s             |
| Execution time   | 72ms           | 81ms             | 6221ms             |
| Memory usage     | 1b             | 120b             | 200b               |
| Executable size  | 35K            | 611K             | 343K               |

==============================================================================

##Questions?

| [Boost].SML |  |
| ------- | ------------- |
| Documentation | http://boost-experimental.github.io/sml |
| Source Code | https://github.com/boost-experimental/sml |
| Try it online | https://github.com/boost-experimental/sml/examples |
<!-- .element: style="margin-left:-13%; width:125%" -->

-

[kris@jusiak.net](mailto:kris@jusiak.net) | [@krisjusiak](https://twitter.com/krisjusiak) | [linkedin.com/in/kris-jusiak](https://www.linkedin.com/in/kris-jusiak)


					</script>
				</section>

			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({

        // Display controls in the bottom right corner
        controls: true,

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // Turns fragments on and off globally
        fragments: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Enable slide navigation via mouse wheel
        mouseWheel: true,

        // Hides the address bar on mobile devices
        hideAddressBar: true,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style
        transition: 'convex', // none/fade/slide/convex/concave/zoom

        // Transition speed
        transitionSpeed: 'default', // default/fast/slow

        // Transition style for full page slide backgrounds
        backgroundTransition: 'default', // none/fade/slide/convex/concave/zoom

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Parallax background image
        parallaxBackgroundImage: '', // e.g. "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'"

        // Parallax background size
        parallaxBackgroundSize: '', // CSS syntax, e.g. "2100px 900px"

        // Number of pixels to move the parallax background per slide
        // - Calculated automatically unless specified
        // - Set to 0 to disable movement along an axis
        parallaxBackgroundHorizontal: null,
        parallaxBackgroundVertical: null,

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
